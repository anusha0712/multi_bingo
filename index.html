<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Sport & TV Bingo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Boldonse&display=swap" rel="stylesheet">
    <script src="game_data.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent: #3b82f6;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --cricket: #ff6b35;
            --tennis: #22c55e;
            --f1: #dc2626;
            --tv: #8b5cf6;
        }
    
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    
        body {
            font-family: "Bebas Neue", sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0c1420 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }
    
        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .header-spacer {
            height: 80px;
        }
    
        .header-content {
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .desktop-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .difficulty-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .difficulty-display-btn {
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        
        .difficulty-display-btn:hover {
            background: var(--bg-card);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .dropdown-arrow {
            font-size: 0.75rem;
            transition: transform 0.2s ease;
        }
        
        .difficulty-display-btn.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .difficulty-menu {
            display: none;
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 0.75rem;
            min-width: 180px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        
        .difficulty-menu.show {
            display: block;
        }
        
        .difficulty-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .difficulty-btn {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left;
        }
        
        .difficulty-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .difficulty-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }
        
        .mobile-settings-menu {
            display: none;
            position: fixed;
            top: 70px;
            right: 1rem;
            left: 1rem;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        
        .mobile-settings-menu.show {
            display: block;
        }
        
        .settings-section {
            margin-bottom: 1rem;
        }
        
        .settings-section:last-child {
            margin-bottom: 0;
        }
        
        .settings-label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .settings-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .settings-action {
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .settings-action:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }
        
        .mobile-menu {
            display: none;
        }
        
        .mobile-menu-btn {
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }
        
        .mobile-menu-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }
    
        .header-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .sport-selector-section {
            background: var(--bg-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
        }
    
        .sport-selector {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            background: var(--bg-primary);
            padding: 0.25rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: fit-content;
            margin: 0 auto;
        }
    
        .sport-btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    
        .sport-btn.active {
            background: var(--accent);
            color: white;
        }
    
        .sport-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }
    
        .btn-icon {
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
    
        .btn-icon:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }
    
        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .game-message {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 2rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .game-message.loss {
            background: linear-gradient(135deg, var(--error) 0%, #dc2626 100%);
        }

        .game-message.win {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        }
    
        .player-section {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
        }
        
        .timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            position: absolute;
            top: 1rem;
            left: 1rem;
        }
        
        .timer:hover {
            opacity: 0.8;
        }
    
        .timer.active {
            color: var(--text-primary);
        }
        
        .timer.inactive {
            color: var(--text-secondary);
            opacity: 0.7;
        }
    
        .player-display {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 1rem 0;
            min-height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent) 0%, #1d4ed8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1.5rem 0;
            gap: 2rem;
        }
    
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    
        .btn-skip {
            background: var(--error);
            color: white;
        }
    
        .btn-skip:hover {
            background: #dc2626;
        }
    
        .btn-wildcard {
            background: var(--warning);
            color: var(--bg-primary);
        }
    
        .btn-wildcard:hover:not(:disabled) {
            background: #f59e0b;
        }
    
        .btn-wildcard:disabled {
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: not-allowed;
        }
        
        .btn-wildcard.active {
            background: var(--success);
            color: white;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
    
        .remaining {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 2rem;
        }
    
        .bingo-card {
            background: var(--bg-card);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 500;
            line-height: 1.3;
            position: relative;
            overflow: hidden;
        }
    
        .bingo-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }
    
        .bingo-card:hover::before {
            left: 100%;
        }
    
        .bingo-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
    
        .bingo-card.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
    
        .bingo-card.completed::before {
            display: none;
        }
        
        .bingo-card.wildcard-selectable {
            border-color: var(--warning);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    
        .stats-panel {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
    
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
    
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 8px;
        }
    
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }
    
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
    
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }
    
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
    
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
    
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }
    
        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        .rules-content {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    
        .rules-content h3 {
            color: var(--accent);
            margin: 1rem 0 0.5rem 0;
            font-weight: 600;
        }
    
        .rules-content p,
        .rules-content li {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }
    
        .rules-content ul {
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
    
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    
        @media (max-width: 768px) {
            .header {
                position: fixed;
                padding: 0.75rem 1rem;
            }
            
            .header-spacer {
                height: 70px;
            }
            
            .header-content {
                padding: 0;
            }
    
            .logo {
                font-size: 1.5rem;
            }
            
            .desktop-controls {
                display: none;
            }
            
            .mobile-menu {
                display: block;
            }
            
            .sport-selector-section {
                padding: 0.75rem 1rem;
                position: relative;
                z-index: 50;
            }
            
            .sport-selector {
                flex-wrap: nowrap;
                justify-content: center;
                max-width: 100%;
                background: var(--bg-primary);
                border: 1px solid rgba(255, 255, 255, 0.1);
                padding: 0.25rem;
            }
            
            .sport-btn {
                flex: 1;
                min-width: 70px;
                font-size: 0.75rem;
                padding: 0.5rem 0.25rem;
                font-weight: 500;
                line-height: 1.2;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.25rem;
            }

            .player-section {
                padding: 1rem;
                margin-bottom: 1rem;
                margin-top: 1rem;
            }
    
            .player-display {
                font-size: 2.5rem;
                margin: 0.5rem 0 1rem 0;
                min-height: 3rem;
                line-height: 1.2;
                word-break: break-word;
            }
    
            .controls {
                flex-direction: row;
                gap: 0.5rem;
                margin: 0.5rem 0;
                align-items: center;
                justify-content: space-between;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 0 0 auto;
                min-width: 80px;
            }

            .remaining {
                font-size: 0.8rem;
                flex: 1;
                justify-content: center;
                margin: 0;
            }
    
            .bingo-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 0.5rem;
                margin-top: 1rem;
            }
    
            .bingo-card {
                min-height: 4rem;
                font-size: 0.75rem;
                padding: 0.5rem;
            }

            .main-container {
                padding: 1rem 0.5rem;
                margin-top: 0;
            }
            
            .mobile-settings-menu {
                top: 70px;
                right: 1rem;
                left: 1rem;
            }
            
            .difficulty-options {
                display: flex;
                gap: 0.5rem;
            }
            
            .difficulty-btn {
                flex: 1;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header-spacer"></div>
    
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>🎯</span>
                <span>Kanoi's 25th Bday Bingo!!</span>
            </div>
            
            <div class="desktop-controls">
                <div class="difficulty-dropdown">
                    <button class="difficulty-display-btn" onclick="toggleDifficultyDropdown()">
                        <span id="currentDifficultyIcon">🟡</span>
                        <span id="currentDifficultyText">Medium</span>
                        <span class="dropdown-arrow">▼</span>
                    </button>
                    <div class="difficulty-menu" id="difficultyMenu">
                        <div class="difficulty-options">
                            <button class="difficulty-btn" data-difficulty="easy">🟢 Easy</button>
                            <button class="difficulty-btn active" data-difficulty="medium">🟡 Medium</button>
                            <button class="difficulty-btn" data-difficulty="hard">🔴 Hard</button>
                        </div>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button class="btn-icon" onclick="resetGame()" title="New Game">
                        🔄
                    </button>
                    <button class="btn-icon" onclick="showStats()" title="Statistics">
                        📊
                    </button>
                    <button class="btn-icon" onclick="showRules()" title="Rules">
                        ❓
                    </button>
                    <button class="btn-icon" onclick="showBirthdayWish()" title="Birthday Wish">
                        🎂
                    </button>
                </div>
            </div>
            
            <div class="mobile-menu">
                <button class="mobile-menu-btn" onclick="toggleMobileSettings()">
                    ⚙️
                </button>
                <div class="mobile-settings-menu" id="mobileSettingsMenu">
                    <div class="settings-section">
                        <label class="settings-label">Difficulty</label>
                        <div class="difficulty-options">
                            <button class="difficulty-btn" data-difficulty="easy">🟢 Easy</button>
                            <button class="difficulty-btn active" data-difficulty="medium">🟡 Medium</button>
                            <button class="difficulty-btn" data-difficulty="hard">🔴 Hard</button>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-actions">
                            <button class="settings-action" onclick="showStats(); closeMobileSettings();">
                                📊 Statistics
                            </button>
                            <button class="settings-action" onclick="showRules(); closeMobileSettings();">
                                ❓ Rules
                            </button>
                            <button class="settings-action" onclick="showBirthdayWish(); closeMobileSettings();">
                                🎂 Birthday Wish
                            </button>
                            <button class="settings-action" onclick="resetGame(); closeMobileSettings();">
                                🔄 New Game
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="sport-selector-section">
        <div class="sport-selector">
            <button class="sport-btn active" data-sport="cricket">
                🏏 Cricket
            </button>
            <button class="sport-btn" data-sport="tennis">
                🎾 Tennis
            </button>
            <button class="sport-btn" data-sport="f1">
                🏎️ F1
            </button>
            <button class="sport-btn" data-sport="tv">
                📺 TV
            </button>
        </div>
    </div>

    <main class="main-container">
        <div class="game-message" id="gameMessage">
            🎉 Congratulations! Bingo Complete! 🎉
            <br><br>
            <button class="btn" onclick="resetGame()" style="background: white; color: var(--success); margin-top: 1rem;">
                🔄 Play Again
            </button>
        </div>

        <div class="player-section">
            <div class="timer" id="timer" onclick="toggleTimer()" title="Click to toggle timer">
                <span>⏱️</span>
                <span id="timerDisplay" style="display: none;">00:00</span>
            </div>
            <div class="player-display" id="currentPlayer">Select a sport to start!</div>
            <div class="controls">
                <button class="btn btn-skip" onclick="skipPlayer()">
                    ⏭️ Skip
                </button>
                <div class="remaining" id="remaining">
                    <span>👥</span>
                    <span>Players ready</span>
                </div>
                <button class="btn btn-wildcard" id="wildcardBtn" onclick="toggleWildcard()">
                    🃏 Wildcard
                </button>
            </div>
        </div>

        <div class="bingo-grid" id="bingoGrid"></div>
    </main>

    <!-- Birthday Wish Modal -->
    <div class="modal" id="birthdayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🎂 Happy Birthday! 🎉</h2>
                <button class="close-btn" onclick="hideBirthdayWish()">&times;</button>
            </div>
            <div class="birthday-content">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 3.2rem; margin-bottom: 1rem;">🎂🎉🎈</div>
                    
                    <div style="background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">
                        Happy 25th Birthday, My Love
                    </div>
                    
                    <div style="color: var(--text-secondary); line-height: 1.8; font-size: 1.1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                        I know I always say that I don't like when you're on your phone, but if it keeps your hyperactive, fidgety
                        brain awake for more TV - it's a win!😈
                        <br><br>
                        So this is a gift that celebrates some of the things I love about you - your capacity for simple joys, your complicated
                        brain that is so tuned to problem-solving and puzzles, your inspiring love for sports and absolute commitment to
                        athletic rigor and the insane memory that holds the most random, long-forgotten trivia and facts (that I love hearing
                        you share).
                        <br><br>
                        This game is modeled after the football bingo you like but with some additional tweaks (like female stars, wildcard
                        entries and difficulty levels). I hope you enjoy playing it hehe
                        <br><br>
                        Anywaaaay, HAPPIEST BIRTHDAYYY to my absolute favourite person!! I love you and I wish I was there to celebrate with you. Cannot
                        wait to witness all the dumb things you will do, now that you have a fully developed frontal lobe to help with more
                        sasti masti antics 👀💕
                        
                    </div>
                    
                    <div style="margin-top: 2rem; font-size: 2rem;">
                        🎊✨🎁✨🎊
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rules Modal -->
    <div class="modal" id="rulesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">📋 How to Play</h2>
                <button class="close-btn" onclick="hideRules()">&times;</button>
            </div>
            <div class="rules-content">
                <h3>🎯 Objective</h3>
                <p>Complete all 16 squares on your bingo card by correctly matching players/characters to categories before running out of players.</p>

                <h3>🎮 How to Play</h3>
                <ul>
                    <li>Choose your difficulty level (Easy/Medium/Hard)</li>
                    <li>A random player/character appears at the top</li>
                    <li>Click on a category square that matches this player</li>
                    <li>If correct ✅ - the square turns green and you get a new player</li>
                    <li>If wrong ❌ - you lose the current player AND the next player (penalty!)</li>
                    <li>Complete all 16 squares to win, or lose when players run out!</li>
                </ul>

                <h3>⚠️ Penalty System</h3>
                <ul>
                    <li><strong>Skip:</strong> Lose current player, move to next player</li>
                    <li><strong>Wrong Answer:</strong> Lose current player, move to next player</li>
                    <li>Strategy matters - use skip when uncertain to avoid wasting good players</li>
                    <li>Finite player pool - no automatic refills during game</li>
                </ul>

                <h3>🃏 Wildcard Power</h3>
                <ul>
                    <li><strong>Click Wildcard</strong> → <strong>Click any square</strong> → That category changes to a new one</li>
                    <li>Perfect escape for overly difficult categories you don't know</li>
                    <li>Current player stays - you can continue matching them</li>
                    <li>Can only be used <strong>once per game</strong> - choose wisely!</li>
                </ul>

                <h3>🏆 Strategy Tips</h3>
                <ul>
                    <li>Save specific categories (like "Afghan Player") for obvious matches</li>
                    <li>Don't risk wrong answers on uncertain matches - skip instead</li>
                    <li>Use wildcard to replace impossible categories</li>
                    <li>Monitor your remaining player count carefully</li>
                </ul>

                <h3>🔄 Difficulty Levels</h3>
                <p><strong>Easy:</strong> 40 players, mostly broad categories (many matches)<br>
                <strong>Medium:</strong> 35 players, mix of broad and medium categories<br>
                <strong>Hard:</strong> 30 players, includes specific categories (few matches)</p>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">📊 Your Statistics</h2>
                <button class="close-btn" onclick="hideStats()">&times;</button>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">Total Games</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completedGames">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="bestTime">--:--</div>
                    <div class="stat-label">Best Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgTime">--:--</div>
                    <div class="stat-label">Avg Time</div>
                </div>
            </div>
            <div style="margin-top: 1rem;">
                <h3 style="color: var(--accent); margin-bottom: 0.5rem;">Daily Progress</h3>
                <div id="dailyProgress" style="color: var(--text-secondary);"></div>
            </div>
            <div style="margin-top: 1.5rem; text-align: center;">
                <button class="btn" onclick="exportStats()" style="background: var(--success); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600;">
                    📤 Export My Stats
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let currentSport = 'cricket';
        let currentDifficulty = 'medium';
        let currentPlayer = '';
        let activePlayerPool = [];
        let originalPlayerPool = [];
        let bingoCards = [];
        let reserveCategories = [];
        let completedCards = [];
        let wildcardUsed = false;
        let wildcardMode = false;
        let gameStartTime = null;
        let timerInterval = null;
        let timerActive = false;
        let gameEnded = false;
        let recentlyUsedCategories = [];
        let recentlyUsedPlayers = [];

        // Sport-specific difficulty configurations - MUCH more strict for Easy
        const difficultyConfig = {
            easy: {
                playerPoolSize: 40,      
                categoryWeight: {
                    // Easy mode: ONLY broad categories, no exceptions
                    tv: { broad: 1.0, medium: 0.0, specific: 0.0 },       // TV Easy: 100% broad only
                    sports: { broad: 1.0, medium: 0.0, specific: 0.0 }    // Sports Easy: 100% broad only
                }
            },
            medium: {
                playerPoolSize: 35,      
                categoryWeight: {
                    tv: { broad: 0.85, medium: 0.15, specific: 0.0 },    // TV Medium: no specific categories
                    sports: { broad: 0.75, medium: 0.25, specific: 0.0 }  // Sports Medium: no specific categories
                }
            },
            hard: {
                playerPoolSize: 30,      
                categoryWeight: {
                    tv: { broad: 0.60, medium: 0.25, specific: 0.15 },    // TV Hard: some challenge
                    sports: { broad: 0.50, medium: 0.35, specific: 0.15 }  // Sports Hard: more challenging
                }
            }
        };

        // Check if game data is loaded
        function checkGameData() {
            if (!window.GAME_DATA || !window.GAME_DATA.playerMatches || !window.GAME_DATA.gameCategories) {
                console.error('Game data not loaded properly. Make sure game_data.js is accessible.');
                document.getElementById('currentPlayer').textContent = 'Error: Game data not loaded!';
                return false;
            }
            return true;
        }

        // TV-specific category analysis - different thresholds than sports
        function analyzeCategoryDifficulty(sport) {
            const allCategories = window.GAME_DATA.gameCategories[sport];
            const allPlayers = window.GAME_DATA.playerMatches[sport];
            
            const categoryAnalysis = {};
            
            allCategories.forEach(category => {
                let matchCount = 0;
                Object.values(allPlayers).forEach(playerCategories => {
                    if (playerCategories.includes(category)) {
                        matchCount++;
                    }
                });
                
                // Different thresholds for TV vs Sports
                let difficulty;
                if (sport === 'tv') {
                    // TV has more specific character traits, so lower thresholds
                    if (matchCount >= 4) {
                        difficulty = 'broad';      // Show categories, role types, broad traits
                    } else if (matchCount >= 2) {
                        difficulty = 'medium';     // Some character relationships, specific roles
                    } else {
                        difficulty = 'specific';   // Unique character traits, single-person facts
                    }
                } else {
                    // Sports categories (original logic)
                    if (matchCount >= 6) {
                        difficulty = 'broad';      
                    } else if (matchCount >= 3) {
                        difficulty = 'medium';     
                    } else {
                        difficulty = 'specific';   
                    }
                }
                
                categoryAnalysis[category] = {
                    matches: matchCount,
                    difficulty: difficulty
                };
            });
            
            return categoryAnalysis;
        }

        // Ensure game winnability - prefer broad categories for replacements in Easy mode
        function ensureWinnability(selectedCategories, playerPool, sport) {
            const playerMatches = window.GAME_DATA.playerMatches[sport];
            const validCategories = [];
            const invalidCategories = [];
            
            selectedCategories.forEach(category => {
                // Check if ANY player in our pool matches this category
                const hasMatch = playerPool.some(player => 
                    playerMatches[player] && playerMatches[player].includes(category)
                );
                
                if (hasMatch) {
                    validCategories.push(category);
                } else {
                    invalidCategories.push(category);
                }
            });
            
            // Replace invalid categories with valid ones
            if (invalidCategories.length > 0) {
                const categoryAnalysis = analyzeCategoryDifficulty(sport);
                const allCategories = Object.keys(categoryAnalysis);
                
                invalidCategories.forEach(invalidCat => {
                    // Find a replacement category that has players in our pool
                    let replacements = allCategories.filter(cat => 
                        !validCategories.includes(cat) && 
                        playerPool.some(player => 
                            playerMatches[player] && playerMatches[player].includes(cat)
                        )
                    );
                    
                    if (replacements.length > 0) {
                        // For Easy mode, strongly prefer broad categories for replacements
                        if (currentDifficulty === 'easy') {
                            const broadReplacements = replacements.filter(cat => 
                                categoryAnalysis[cat].difficulty === 'broad'
                            );
                            if (broadReplacements.length > 0) {
                                replacements = broadReplacements;
                            }
                        }
                        
                        const replacement = replacements[0];
                        validCategories.push(replacement);
                    }
                });
            }
            
            return validCategories.slice(0, 16); // Ensure we have exactly 16
        }
        // Fixed smart category selection with sport-specific weights
        function selectSmartCategories(sport, difficulty) {
            const categoryAnalysis = analyzeCategoryDifficulty(sport);
            const config = difficultyConfig[difficulty];
            
            // Get sport-specific weights
            const sportType = sport === 'tv' ? 'tv' : 'sports';
            const weights = config.categoryWeight[sportType];
            
            // Group categories by difficulty
            const categoryGroups = {
                broad: [],
                medium: [],
                specific: []
            };
            
            Object.entries(categoryAnalysis).forEach(([category, data]) => {
                // Skip recently used categories to increase variety
                if (recentlyUsedCategories.includes(category)) return;
                
                categoryGroups[data.difficulty].push(category);
            });
            
            // If we don't have enough variety, allow some recent categories back
            if (categoryGroups.broad.length + categoryGroups.medium.length + categoryGroups.specific.length < 20) {
                Object.entries(categoryAnalysis).forEach(([category, data]) => {
                    if (!categoryGroups[data.difficulty].includes(category)) {
                        categoryGroups[data.difficulty].push(category);
                    }
                });
            }
            
            // Select categories based on sport-specific difficulty weights  
            const selectedCategories = [];
            const targetCounts = {
                broad: Math.round(16 * weights.broad),
                medium: Math.round(16 * weights.medium),
                specific: Math.round(16 * weights.specific)
            };
            
            // Adjust if rounding doesn't add up to 16
            const totalSelected = targetCounts.broad + targetCounts.medium + targetCounts.specific;
            if (totalSelected !== 16) {
                targetCounts.broad += (16 - totalSelected); // Add extra to broad (easier)
            }
            
            // Select from each group
            Object.entries(targetCounts).forEach(([difficultyType, count]) => {
                const availableCategories = shuffleArray(categoryGroups[difficultyType]);
                selectedCategories.push(...availableCategories.slice(0, count));
            });
            
            // Fill remaining slots ONLY with broad categories for Easy mode
            while (selectedCategories.length < 16) {
                if (currentDifficulty === 'easy') {
                    // Easy mode: ONLY use broad categories
                    const broadRemaining = categoryGroups.broad.filter(cat => !selectedCategories.includes(cat));
                    if (broadRemaining.length === 0) {
                        // If no broad categories left, get more from all categories but prefer broad
                        const allCategoriesByDifficulty = Object.entries(categoryAnalysis)
                            .filter(([cat]) => !selectedCategories.includes(cat))
                            .sort((a, b) => {
                                // Sort by difficulty: broad first, then medium, then specific
                                const order = { broad: 0, medium: 1, specific: 2 };
                                return order[a[1].difficulty] - order[b[1].difficulty];
                            });
                        
                        if (allCategoriesByDifficulty.length === 0) break;
                        selectedCategories.push(allCategoriesByDifficulty[0][0]);
                    } else {
                        selectedCategories.push(shuffleArray(broadRemaining)[0]);
                    }
                } else {
                    // Medium/Hard mode: can use any remaining categories
                    const broadRemaining = categoryGroups.broad.filter(cat => !selectedCategories.includes(cat));
                    if (broadRemaining.length === 0) {
                        const allRemaining = Object.values(categoryGroups).flat()
                            .filter(cat => !selectedCategories.includes(cat));
                        if (allRemaining.length === 0) break;
                        selectedCategories.push(shuffleArray(allRemaining)[0]);
                    } else {
                        selectedCategories.push(shuffleArray(broadRemaining)[0]);
                    }
                }
            }
            
            // Select reserve categories (prefer broad ones for wildcard)
            const remainingCategories = Object.keys(categoryAnalysis)
                .filter(cat => !selectedCategories.includes(cat));
            const broadReserves = remainingCategories.filter(cat => 
                categoryAnalysis[cat].difficulty === 'broad'
            );
            const reserves = shuffleArray(broadReserves.length >= 3 ? broadReserves : remainingCategories).slice(0, 3);
            
            // Track recently used categories
            recentlyUsedCategories.push(...selectedCategories);
            if (recentlyUsedCategories.length > 50) {
                recentlyUsedCategories = recentlyUsedCategories.slice(-30);
            }
            
            return {
                main: shuffleArray(selectedCategories).slice(0, 16),
                reserve: reserves
            };
        }

        // Revamped player pool creation - much more inclusive
        function createPlayerPool(sport, selectedCategories, difficulty) {
            const allPlayers = Object.keys(window.GAME_DATA.playerMatches[sport]);
            const config = difficultyConfig[difficulty];
            
            // Create weighted player selection
            const playerWeights = {};
            
            allPlayers.forEach(player => {
                const playerCategories = window.GAME_DATA.playerMatches[sport][player];
                
                // Count matches with selected categories
                const matchCount = selectedCategories.filter(cat => 
                    playerCategories.includes(cat)
                ).length;
                
                // Weight players based on relevance, but don't exclude anyone completely
                if (matchCount >= 3) {
                    playerWeights[player] = 3; // High relevance
                } else if (matchCount >= 1) {
                    playerWeights[player] = 2; // Medium relevance
                } else {
                    playerWeights[player] = 1; // Low relevance, but still included
                }
                
                // Reduce weight for recently used players
                if (recentlyUsedPlayers.includes(player)) {
                    playerWeights[player] = Math.max(1, playerWeights[player] - 1);
                }
            });
            
            // Create weighted selection pool
            const weightedPool = [];
            Object.entries(playerWeights).forEach(([player, weight]) => {
                for (let i = 0; i < weight; i++) {
                    weightedPool.push(player);
                }
            });
            
            // Select players with weighted randomization
            const selectedPlayers = [];
            const shuffledPool = shuffleArray(weightedPool);
            
            for (let i = 0; i < config.playerPoolSize && selectedPlayers.length < config.playerPoolSize; i++) {
                const player = shuffledPool[i % shuffledPool.length];
                if (!selectedPlayers.includes(player)) {
                    selectedPlayers.push(player);
                }
            }
            
            // Track recently used players
            recentlyUsedPlayers.push(...selectedPlayers);
            if (recentlyUsedPlayers.length > 80) {
                recentlyUsedPlayers = recentlyUsedPlayers.slice(-50); // Keep last 50
            }
            
            return shuffleArray(selectedPlayers);
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Game Functions
        function initGame() {
            if (!checkGameData()) return;
            
            generateSmartBingoCards();
            nextPlayer();
            updateDisplay();
            updateStats();
        }

        function generateSmartBingoCards() {
            // First create player pool
            const allPlayers = Object.keys(window.GAME_DATA.playerMatches[currentSport]);
            activePlayerPool = shuffleArray(allPlayers).slice(0, difficultyConfig[currentDifficulty].playerPoolSize);
            
            // Then select categories based on difficulty
            let categorySet = selectSmartCategories(currentSport, currentDifficulty);
            
            // Ensure all selected categories are winnable with our player pool
            const winnableCategories = ensureWinnability(categorySet.main, activePlayerPool, currentSport);
            bingoCards = winnableCategories;
            
            // Create reserve categories that are also winnable
            const winnableReserves = ensureWinnability(categorySet.reserve, activePlayerPool, currentSport);
            reserveCategories = winnableReserves.slice(0, 2);
            
            originalPlayerPool = [...activePlayerPool];
            
            completedCards = [];
            wildcardUsed = false;
            wildcardMode = false;
            gameEnded = false;
            renderBingoGrid();
            hideGameMessage();
        }

        function renderBingoGrid() {
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = '';
            
            bingoCards.forEach((category, index) => {
                const card = document.createElement('div');
                card.className = 'bingo-card';
                card.textContent = category;
                card.onclick = () => selectCard(index);
                
                if (completedCards.includes(index)) {
                    card.classList.add('completed');
                    card.onclick = null;
                } else if (wildcardMode) {
                    card.classList.add('wildcard-selectable');
                    card.onclick = () => useWildcardOnCard(index);
                }
                
                grid.appendChild(card);
            });
        }

        function nextPlayer() {
            if (gameEnded) return;
            
            if (activePlayerPool.length === 0) {
                endGame(false); // Lost - no more players
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * activePlayerPool.length);
            currentPlayer = activePlayerPool[randomIndex];
            activePlayerPool.splice(randomIndex, 1);
            updateDisplay();
        }

        function selectCard(cardIndex) {
            if (completedCards.includes(cardIndex) || wildcardMode || gameEnded) return;
            
            const selectedCategory = bingoCards[cardIndex];
            const playerCategories = window.GAME_DATA.playerMatches[currentSport][currentPlayer] || [];
            
            const card = document.querySelectorAll('.bingo-card')[cardIndex];
            
            if (playerCategories.includes(selectedCategory)) {
                // Correct match
                completedCards.push(cardIndex);
                card.style.background = 'var(--success)';
                card.style.borderColor = 'var(--success)';
                card.style.color = 'white';
                
                if (completedCards.length === 16) {
                    endGame(true); // Won - completed all squares
                    return;
                }
                
                setTimeout(() => {
                    nextPlayer();
                    renderBingoGrid();
                }, 800);
            } else {
                // Wrong match - just lose current player (no double penalty)
                card.style.background = 'var(--error)';
                card.style.borderColor = 'var(--error)';
                
                setTimeout(() => {
                    card.style.background = 'var(--bg-card)';
                    card.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                    nextPlayer(); // Just move to next player
                }, 800);
            }
        }

        function skipPlayer() {
            if (gameEnded) return;
            // Skip just loses current player, moves to next
            nextPlayer();
        }

        function toggleWildcard() {
            if (wildcardUsed || gameEnded) return;
            
            wildcardMode = !wildcardMode;
            const wildcardBtn = document.getElementById('wildcardBtn');
            
            if (wildcardMode) {
                wildcardBtn.classList.add('active');
                wildcardBtn.textContent = '✨ Select Square';
                renderBingoGrid(); // Add wildcard-selectable class
            } else {
                wildcardBtn.classList.remove('active');
                wildcardBtn.textContent = '🃏 Wildcard';
                renderBingoGrid(); // Remove wildcard-selectable class
            }
        }

        function useWildcardOnCard(cardIndex) {
            if (!wildcardMode || wildcardUsed || completedCards.includes(cardIndex) || gameEnded) return;
            
            wildcardUsed = true;
            wildcardMode = false;
            
            // Use a reserve category if available
            if (reserveCategories.length > 0) {
                const newCategory = reserveCategories.shift();
                bingoCards[cardIndex] = newCategory;
            } else {
                // Fallback: get any unused category
                const categoryAnalysis = analyzeCategoryDifficulty(currentSport);
                const unusedCategories = Object.keys(categoryAnalysis).filter(cat => 
                    !bingoCards.includes(cat)
                );
                
                if (unusedCategories.length > 0) {
                    // Prefer medium difficulty categories for wildcard
                    const mediumCategories = unusedCategories.filter(cat => 
                        categoryAnalysis[cat].difficulty === 'medium'
                    );
                    
                    const newCategory = mediumCategories.length > 0 ? 
                        mediumCategories[Math.floor(Math.random() * mediumCategories.length)] :
                        unusedCategories[Math.floor(Math.random() * unusedCategories.length)];
                    
                    bingoCards[cardIndex] = newCategory;
                }
            }
            
            renderBingoGrid();
            updateDisplay();
        }

        function endGame(won) {
            gameEnded = true;
            stopTimer();
            
            const gameMessage = document.getElementById('gameMessage');
            
            if (won) {
                gameMessage.className = 'game-message win';
                gameMessage.innerHTML = `
                    🎉 Congratulations! Bingo Complete! 🎉
                    <br><br>
                    <button class="btn" onclick="resetGame()" style="background: white; color: var(--success); margin-top: 1rem;">
                        🔄 Play Again
                    </button>
                `;
                saveGameStats(true);
            } else {
                gameMessage.className = 'game-message loss';
                gameMessage.innerHTML = `
                    😔 Game Over! Ran out of players 😔
                    <br>
                    <small>Completed ${completedCards.length}/16 squares</small>
                    <br><br>
                    <button class="btn" onclick="resetGame()" style="background: white; color: var(--error); margin-top: 1rem;">
                        🔄 Try Again
                    </button>
                `;
                saveGameStats(false);
            }
            
            gameMessage.style.display = 'block';
            updateStats();
        }

        function hideGameMessage() {
            document.getElementById('gameMessage').style.display = 'none';
        }

        function changeDifficulty(difficulty) {
            currentDifficulty = difficulty;
            
            // Update button states in both desktop and mobile
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll(`[data-difficulty="${difficulty}"]`).forEach(btn => {
                btn.classList.add('active');
            });
            
            // Update the desktop difficulty display
            updateDifficultyDisplay(difficulty);
            
            // Close dropdowns
            closeDifficultyDropdown();
            closeMobileSettings();
            
            resetGame();
        }
        
        function updateDifficultyDisplay(difficulty) {
            const icons = { easy: '🟢', medium: '🟡', hard: '🔴' };
            const names = { easy: 'Easy', medium: 'Medium', hard: 'Hard' };
            
            const iconEl = document.getElementById('currentDifficultyIcon');
            const textEl = document.getElementById('currentDifficultyText');
            
            if (iconEl) iconEl.textContent = icons[difficulty];
            if (textEl) textEl.textContent = names[difficulty];
        }
        
        function toggleDifficultyDropdown() {
            const menu = document.getElementById('difficultyMenu');
            const btn = document.querySelector('.difficulty-display-btn');
            
            menu.classList.toggle('show');
            btn.classList.toggle('active');
        }
        
        function closeDifficultyDropdown() {
            const menu = document.getElementById('difficultyMenu');
            const btn = document.querySelector('.difficulty-display-btn');
            
            if (menu) menu.classList.remove('show');
            if (btn) btn.classList.remove('active');
        }
        
        function toggleMobileSettings() {
            const menu = document.getElementById('mobileSettingsMenu');
            menu.classList.toggle('show');
        }
        
        function closeMobileSettings() {
            const menu = document.getElementById('mobileSettingsMenu');
            if (menu) menu.classList.remove('show');
        }

        function resetGame() {
            completedCards = [];
            wildcardUsed = false;
            wildcardMode = false;
            gameEnded = false;
            hideGameMessage();
            generateSmartBingoCards();
            nextPlayer();
            if (timerActive) {
                startTimer();
            }
        }

        function switchSport(sport) {
            currentSport = sport;
            
            document.querySelectorAll('.sport-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-sport="${sport}"]`).classList.add('active');
            
            resetGame();
        }

        function updateDisplay() {
            document.getElementById('currentPlayer').textContent = currentPlayer || 'Select a sport to start!';
            document.getElementById('remaining').innerHTML = `<span>👥</span><span>${activePlayerPool.length} players remaining</span>`;
            
            const wildcardBtn = document.getElementById('wildcardBtn');
            if (wildcardUsed) {
                wildcardBtn.disabled = true;
                wildcardBtn.textContent = '🃏 Used';
                wildcardBtn.classList.remove('active');
            } else if (wildcardMode) {
                wildcardBtn.textContent = '✨ Select Square';
                wildcardBtn.classList.add('active');
            } else {
                wildcardBtn.textContent = '🃏 Wildcard';
                wildcardBtn.classList.remove('active');
                wildcardBtn.disabled = false;
            }
        }

        // Timer Functions  
        function startTimer() {
            if (!timerActive) return;
            
            gameStartTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimer() {
            if (!gameStartTime) return;
            
            const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function toggleTimer() {
            timerActive = !timerActive;
            const timer = document.getElementById('timer');
            const timerDisplay = document.getElementById('timerDisplay');
            
            if (timerActive) {
                timer.classList.add('active');
                timer.classList.remove('inactive');
                timerDisplay.style.display = 'inline';
                startTimer();
            } else {
                timer.classList.remove('active');
                timer.classList.add('inactive');
                timerDisplay.style.display = 'none';
                stopTimer();
            }
        }

        // Stats Functions
        function getStats() {
            const stats = localStorage.getItem('bingoStats');
            return stats ? JSON.parse(stats) : {
                totalGames: 0,
                completedGames: 0,
                currentStreak: 0,
                bestTime: null,
                times: [],
                dailyProgress: {}
            };
        }

        function saveGameStats(completed) {
            const stats = getStats();
            const today = new Date().toDateString();
            
            stats.totalGames++;
            
            if (completed) {
                stats.completedGames++;
                stats.currentStreak++;
                
                if (gameStartTime && timerActive) {
                    const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
                    stats.times.push(gameTime);
                    
                    if (!stats.bestTime || gameTime < stats.bestTime) {
                        stats.bestTime = gameTime;
                    }
                }
            } else {
                stats.currentStreak = 0;
            }
            
            if (!stats.dailyProgress[today]) {
                stats.dailyProgress[today] = { completed: 0, total: 0 };
            }
            stats.dailyProgress[today].total++;
            if (completed) {
                stats.dailyProgress[today].completed++;
            }
            
            localStorage.setItem('bingoStats', JSON.stringify(stats));
        }

        function updateStats() {
            const stats = getStats();
            
            document.getElementById('totalGames').textContent = stats.totalGames;
            document.getElementById('completedGames').textContent = stats.completedGames;
            document.getElementById('winRate').textContent = 
                stats.totalGames > 0 ? Math.round((stats.completedGames / stats.totalGames) * 100) + '%' : '0%';
            document.getElementById('currentStreak').textContent = stats.currentStreak;
            
            if (stats.bestTime) {
                const minutes = Math.floor(stats.bestTime / 60);
                const seconds = stats.bestTime % 60;
                document.getElementById('bestTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            if (stats.times.length > 0) {
                const avgTime = stats.times.reduce((a, b) => a + b, 0) / stats.times.length;
                const minutes = Math.floor(avgTime / 60);
                const seconds = Math.floor(avgTime % 60);
                document.getElementById('avgTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function exportStats() {
            const stats = getStats();
            const exportData = {
                summary: `🎯 Bingo Stats Summary 🎯\n\nTotal Games: ${stats.totalGames}\nCompleted: ${stats.completedGames}\nWin Rate: ${stats.totalGames > 0 ? Math.round((stats.completedGames / stats.totalGames) * 100) : 0}%\nCurrent Streak: ${stats.currentStreak}`,
                date: new Date().toLocaleDateString(),
                stats: stats
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bingo-stats-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Modal Functions
        function showRules() {
            document.getElementById('rulesModal').style.display = 'block';
        }

        function hideRules() {
            document.getElementById('rulesModal').style.display = 'none';
        }

        function showStats() {
            updateStats();
            document.getElementById('statsModal').style.display = 'block';
        }

        function hideStats() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function showBirthdayWish() {
            document.getElementById('birthdayModal').style.display = 'block';
        }

        function hideBirthdayWish() {
            document.getElementById('birthdayModal').style.display = 'none';
        }

        // Event Listeners
        document.querySelectorAll('.sport-btn').forEach(btn => {
            btn.addEventListener('click', () => switchSport(btn.dataset.sport));
        });
        
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                changeDifficulty(btn.dataset.difficulty);
            });
        });
        
        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            const difficultyDropdown = document.querySelector('.difficulty-dropdown');
            const mobileMenu = document.querySelector('.mobile-menu');
            
            if (!difficultyDropdown?.contains(e.target)) {
                closeDifficultyDropdown();
            }
            
            if (!mobileMenu?.contains(e.target)) {
                closeMobileSettings();
            }
        });

        // Close modals on outside click
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            
            // Always show rules on page load
            setTimeout(() => showRules(), 500);
        });
    </script>
</body>
</html>